<!DOCTYPE html>
<html lang="en">

<head>
  
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>hertzg/node-net-keeplive Home</title>

  <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="./build/entry.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <link href="https://fonts.googleapis.com/css?family=Roboto:100,400,700|Inconsolata,700" rel="stylesheet">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
  <link type="text/css" rel="stylesheet" href="https://jmblog.github.io/color-themes-for-google-code-prettify/themes/tomorrow-night.min.css">
  <link type="text/css" rel="stylesheet" href="styles/app.min.css">
  <link type="text/css" rel="stylesheet" href="styles/iframe.css">
  <link type="text/css" rel="stylesheet" href="">
  <script async defer src="https://buttons.github.io/buttons.js"></script>

  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-1091155-6"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());gtag('config', 'UA-1091155-6');</script>
  
</head>



<body class="layout small-header">
    <div id="stickyNavbarOverlay"></div>
    

<div class="top-nav">
    <div class="inner">
        <a id="hamburger" role="button" class="navbar-burger" aria-label="menu" aria-expanded="false">
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
        </a>
        <div class="logo">
            
             
                <a href="index.html">
                    <h1 class="navbar-item">net-keepalive Documentation</h1>
                </a>
            
        </div>
        <div class="menu">
            
            <div class="navigation">
                <a
                    href="index.html"
                    class="link"
                >
                    API Documentation
                </a>
                
                 
                    
                        <a
                            class="link user-link "
                            href="https://github.com/hertzg/node-net-keepalive"
                        >
                            Github
                        </a>
                    
                
                
            </div>
        </div>
    </div>
</div>
    <div id="main">
        <div
            class="sidebar "
            id="sidebarNav"
        >
            
            <nav>
                
                    <h2><a href="index.html">Documentation</a></h2><div class="category"><h3>Modules</h3><ul><li><a href="module-net-keepalive.html">net-keepalive</a></li></ul></div>
                
            </nav>
        </div>
        <div class="core" id="main-content-wrapper">
            <div class="content">
                <header class="page-title">
                    <p></p>
                    <h1>Home</h1>
                </header>
                



    


    <h3> </h3>










    




    <section>
        <article><p><a href="https://www.npmjs.com/package/net-keepalive"><img src="https://img.shields.io/npm/v/net-keepalive.svg?style=flat" alt="NPM"></a>
<a href="https://dist.nodejs.org"><img src="https://img.shields.io/badge/node-%3E%3D10.20.0-green.svg" alt="Node"></a>
<a href="https://www.npmjs.com/package/net-keepalive"><img src="https://img.shields.io/badge/os-linux%2Cosx%2Cbsd-green.svg" alt="OS"></a>
<a href="https://codecov.io/gh/hertzg/node-net-keepalive"><img src="https://codecov.io/gh/hertzg/node-net-keepalive/branch/master/graph/badge.svg" alt="Codecov"></a>
<a href="https://travis-ci.org/hertzg/node-net-keepalive"><img src="https://travis-ci.org/hertzg/node-net-keepalive.svg?branch=master" alt="CI"></a>
<a href="https://david-dm.org/hertzg/node-net-keepalive"><img src="https://david-dm.org/hertzg/node-net-keepalive.svg" alt="Dependencies"></a>
<a href="https://www.codacy.com/app/hertzg/node-net-keepalive"><img src="https://api.codacy.com/project/badge/Grade/d191b6408086432586e6c60577485c6f" alt="Code Quality"></a>
<a href="https://raw.githubusercontent.com/hertzg/node-net-keepalive/master/LICENSE"><img src="https://img.shields.io/badge/license-MIT-blue.svg" alt="License"></a></p>
<!-- ALL-CONTRIBUTORS-BADGE:START - Do not remove or modify this section -->
<p><a href="#contributors-"><img src="https://img.shields.io/badge/all_contributors-10-orange.svg?style=flat-square" alt="All Contributors"></a></p>
<!-- ALL-CONTRIBUTORS-BADGE:END -->
<h1>üîó net-keepalive</h1>
<p><a href="https://nodei.co/npm/net-keepalive/"><img src="https://nodei.co/npm/net-keepalive.png?downloads=true&amp;downloadRank=true&amp;stars=true" alt="NPM"></a></p>
<p>The Missing (<code>TCP_KEEPINTVL</code> and <code>TCP_KEEPCNT</code>) <code>SO_KEEPALIVE</code> socket option setters and getters for Node using <a href="https://www.npmjs.com/package/ffi-napi"><code>ffi-napi</code></a> module.</p>
<p>Tested on üêß <code>linux</code> &amp; üçè <code>osx</code> (both <code>amd64</code> and <code>arm64</code>), should work on üòà <code>freebsd</code> and others.
Installs on üêÑ <code>win32</code> üéâ but methods are no-ops (pull requests welcome).</p>
<p>There's also support for getting &amp; setting the <code>TCP_USER_TIMEOUT</code> (üêß <code>linux</code>  and üçè <code>osx</code> only) option, which is closely related to keep-alive.</p>
<h2>Platform support</h2>
<table>
<thead>
<tr>
<th>Platform</th>
<th>TCP_KEEPINTVL</th>
<th>TCP_KEEPCNT</th>
<th>TCP_USER_TIMEOUT</th>
</tr>
</thead>
<tbody>
<tr>
<td>üêß <code>linux</code></td>
<td>‚úÖ</td>
<td>‚úÖ</td>
<td>‚úÖ</td>
</tr>
<tr>
<td>üçè <code>osx</code></td>
<td>‚úÖ</td>
<td>‚úÖ</td>
<td>‚úÖ (<code>TCP_RXT_CONNDROPTIME</code>)</td>
</tr>
<tr>
<td>üòà <code>freebsd</code></td>
<td>‚úÖ</td>
<td>‚úÖ</td>
<td>‚ùå</td>
</tr>
<tr>
<td>üêÑ <code>win32</code></td>
<td>‚ûñ</td>
<td>‚ûñ</td>
<td>‚ûñ</td>
</tr>
</tbody>
</table>
<p>Legend:</p>
<ul>
<li>‚úÖ - Supported</li>
<li>‚ûñ - No operation</li>
<li>‚ùå - Unsupported (throws)</li>
</ul>
<h2>Install</h2>
<pre class="prettyprint source lang-bash"><code>npm install --save net-keepalive
</code></pre>
<h2>Documentation</h2>
<p>You can find the <a href="https://hertzg.github.io/node-net-keepalive">full API Reference Document (JSDoc)</a> published on our github pages.</p>
<p>The project includes TypeScript definitions file (<code>index.d.ts</code>) which gives an overview of the API exposed.</p>
<p>Documentation gets generated from JSDoc comments, feel free to improve them by sending pull requests.</p>
<h2>Demo</h2>
<pre class="prettyprint source lang-javascript"><code>const Net = require('net'),
  NetKeepAlive = require('net-keepalive')
// or
import * as Net from 'net'
import * as NetKeepAlive from 'net-keepalive'

// Create a TCP Server
const srv = Net.createServer((s) => {
  console.log('Connected %j', s.address())
  // Doesn't matter what it does
  s.pipe(s)
})

// Start on some port
srv.listen(1337, () => {
  console.log('Listening on %j', srv.address())
})

// Connect to that server
const s = Net.createConnection({ port: 1337 }, () => {
  console.log('Connected to %j', s.address())

  //IMPORTANT: KeepAlive must be enabled for this to work
  s.setKeepAlive(true, 1000)

  // Set TCP_KEEPINTVL for this specific socket
  NetKeepAlive.setKeepAliveInterval(s, 1000)

  // Get TCP_KEEPINTVL for this specific socket
  NetKeepAlive.getKeepAliveInterval(s) // 1000

  // Set TCP_KEEPCNT for this specific socket
  NetKeepAlive.setKeepAliveProbes(s, 1)

  // Get TCP_KEEPCNT for this specific socket
  NetKeepAlive.getKeepAliveProbes(s) // 1
})
</code></pre>
<p>Now using <code>iptables</code> add rule to drop all <code>tcp</code> packets on <code>INPUT</code> chain to port <code>1337</code>.</p>
<pre class="prettyprint source lang-bash"><code>iptables -I INPUT -m tcp -p tcp --dport 1337 -j DROP
</code></pre>
<p>If you were monitoring packets on <code>loopback</code> with <code>tcp.srcport == 1337 || tcp.dstport == 1337</code> filter in <code>wireshark</code>. You will see the following output:</p>
<p><a href="http://hertzg.github.io/node-net-keepalive/images/wireshark.jpg"><img src="http://hertzg.github.io/node-net-keepalive/images/wireshark.jpg" alt="Wireshark screenshot KEEPALIVE"></a></p>
<p>Have fun!</p>
<p>More info about <code>SO_KEEPALIVE</code> here: <a href="http://tldp.org/HOWTO/TCP-Keepalive-HOWTO/">TCP Keepalive HOWTO</a>
<code>C</code> Code examples here: <a href="http://tldp.org/HOWTO/TCP-Keepalive-HOWTO/programming.html#examples">Examples</a></p>
<h2>Sample</h2>
<p><strong><em>Note: For these methods to work you must enable <code>SO_KEEPALIVE</code> and set the <code>TCP_KEEPIDLE</code> options for socket using <code>Net.Socket</code>-s built in method <a href="https://nodejs.org/api/net.html#net_socket_setkeepalive_enable_initialdelay"><code>socket.setKeepAlive([enable][, initialDelay])</code></a> !</em></strong></p>
<pre><code>TCP_KEEPIDLE (since Linux 2.4) The time (in seconds) the connection needs to remain idle before TCP starts sending keepalive probes, if the socket option SO_KEEPALIVE has been set on this socket. This option should not be used in code intended to be portable.
</code></pre>
<pre class="prettyprint source lang-JavaScript"><code>const NetKeepAlive = require('net-keepalive')
// or
import * as NetKeepAlive from 'net-keepalive'

// .....

const enable = true                                             // enable SO_KEEPALIVE
const initialDuration = 1000                                    // start probing after 1 second of inactivity
socket.setKeepAlive(enable, initialDuration)                    // sets SO_KEEPALIVE and TCP_KEEPIDLE

const probeInterval = 1000                                      // after initialDuration send probes every 1 second
NetKeepAlive.setKeepAliveInterval(socket, probeInterval)        //sets TCP_KEEPINTVL

const maxProbesBeforeFail = 10                                  // after 10 failed probes connection will be dropped
NetKeepAlive.setKeepAliveProbes(socket, maxProbesBeforeFail)    // sets TCP_KEEPCNT

// ....
</code></pre>
<h2>Code of Conduct</h2>
<p>See <a href="CODE_OF_CONDUCT.md">CODE_OF_CONDUCT.md</a></p>
<h2>Contributing</h2>
<p>See <a href="CONTRIBUTING.md">CONTRIBUTING.md</a></p>
<h2>Contributors ‚ú®</h2>
<p>Thanks goes to these wonderful people (<a href="https://allcontributors.org/docs/en/emoji-key">emoji key</a>):</p>
<!-- ALL-CONTRIBUTORS-LIST:START - Do not remove or modify this section -->
<!-- prettier-ignore-start -->
<!-- markdownlint-disable -->
<table>
  <tr>
    <td align="center"><a href="http://hertz.gg"><img src="https://avatars3.githubusercontent.com/u/1886698?v=4?s=100" width="100px;" alt=""/><br /><sub><b>George Hertz</b></sub></a><br /><a href="#maintenance-hertzg" title="Maintenance">üöß</a> <a href="https://github.com/hertzg/node-net-keepalive/commits?author=hertzg" title="Code">üíª</a> <a href="https://github.com/hertzg/node-net-keepalive/commits?author=hertzg" title="Documentation">üìñ</a> <a href="https://github.com/hertzg/node-net-keepalive/commits?author=hertzg" title="Tests">‚ö†Ô∏è</a> <a href="#platform-hertzg" title="Packaging/porting to new platform">üì¶</a> <a href="#question-hertzg" title="Answering Questions">üí¨</a></td>
    <td align="center"><a href="https://github.com/mildsunrise"><img src="https://avatars0.githubusercontent.com/u/1177304?v=4?s=100" width="100px;" alt=""/><br /><sub><b>Alba Mendez</b></sub></a><br /><a href="https://github.com/hertzg/node-net-keepalive/commits?author=mildsunrise" title="Code">üíª</a> <a href="https://github.com/hertzg/node-net-keepalive/commits?author=mildsunrise" title="Documentation">üìñ</a> <a href="https://github.com/hertzg/node-net-keepalive/commits?author=mildsunrise" title="Tests">‚ö†Ô∏è</a></td>
    <td align="center"><a href="https://www.linkedin.com/in/pfcastro/"><img src="https://avatars3.githubusercontent.com/u/15091591?v=4?s=100" width="100px;" alt=""/><br /><sub><b>Paulo Castro</b></sub></a><br /><a href="https://github.com/hertzg/node-net-keepalive/issues?q=author%3Apdcastro" title="Bug reports">üêõ</a></td>
    <td align="center"><a href="http://www.immersiveapplications.com/"><img src="https://avatars1.githubusercontent.com/u/481412?v=4?s=100" width="100px;" alt=""/><br /><sub><b>Jacob Jewell</b></sub></a><br /><a href="https://github.com/hertzg/node-net-keepalive/issues?q=author%3Ajakesjews" title="Bug reports">üêõ</a></td>
    <td align="center"><a href="https://github.com/RMutharaju"><img src="https://avatars0.githubusercontent.com/u/37263240?v=4?s=100" width="100px;" alt=""/><br /><sub><b>RMutharaju</b></sub></a><br /><a href="#security-RMutharaju" title="Security">üõ°Ô∏è</a></td>
    <td align="center"><a href="https://github.com/borger"><img src="https://avatars0.githubusercontent.com/u/5930158?v=4?s=100" width="100px;" alt=""/><br /><sub><b>Rafael Borges</b></sub></a><br /><a href="https://github.com/hertzg/node-net-keepalive/issues?q=author%3Aborger" title="Bug reports">üêõ</a></td>
    <td align="center"><a href="https://github.com/selient"><img src="https://avatars2.githubusercontent.com/u/3947590?v=4?s=100" width="100px;" alt=""/><br /><sub><b>Calvin</b></sub></a><br /><a href="https://github.com/hertzg/node-net-keepalive/issues?q=author%3Aselient" title="Bug reports">üêõ</a></td>
  </tr>
  <tr>
    <td align="center"><a href="https://github.com/ggsubs"><img src="https://avatars2.githubusercontent.com/u/2170237?v=4?s=100" width="100px;" alt=""/><br /><sub><b>ggsubs</b></sub></a><br /><a href="https://github.com/hertzg/node-net-keepalive/issues?q=author%3Aggsubs" title="Bug reports">üêõ</a></td>
    <td align="center"><a href="https://mario.kozjak.io/"><img src="https://avatars1.githubusercontent.com/u/3506172?v=4?s=100" width="100px;" alt=""/><br /><sub><b>Mario Kozjak</b></sub></a><br /><a href="https://github.com/hertzg/node-net-keepalive/issues?q=author%3Amkozjak" title="Bug reports">üêõ</a></td>
    <td align="center"><a href="https://codeisland.org/"><img src="https://avatars2.githubusercontent.com/u/692211?v=4?s=100" width="100px;" alt=""/><br /><sub><b>Lukas Knuth</b></sub></a><br /><a href="https://github.com/hertzg/node-net-keepalive/commits?author=LukasKnuth" title="Code">üíª</a></td>
  </tr>
</table>
<!-- markdownlint-restore -->
<!-- prettier-ignore-end -->
<!-- ALL-CONTRIBUTORS-LIST:END -->
<p>This project follows the <a href="https://github.com/all-contributors/all-contributors">all-contributors</a> specification. Contributions of any kind welcome!</p></article>
    </section>






            </div>
            
        </div>
        <div id="side-nav" class="side-nav">
        </div>
    </div>
<script src="scripts/app.min.js"></script>
<script>PR.prettyPrint();</script>
<script src="scripts/linenumber.js"> </script>

</body>
</html>